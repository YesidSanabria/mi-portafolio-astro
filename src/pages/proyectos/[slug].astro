---
import Layout from '../../layouts/Layout.astro';
import projects from '../../data/proyectos.json';

export async function getStaticPaths() {
  return projects.map(project => ({
    params: { slug: project.id },
    props: { project },
  }));
}

const { project } = Astro.props as { [key: string]: any };

const funcionalidades = [];
for (let i = 1; i <= 6; i++) {
  if (project[`funcion${i}`] && project[`funcion${i}_1`]) {
    funcionalidades.push({
      title: project[`funcion${i}`],
      description: project[`funcion${i}_1`],
    });
  }
}

const tecnologiasTabla = [];
for (let i = 1; i <= 4; i++) {
    if (project[`tectno${i}`] && project[`tectno${i}_1`]) {
        tecnologiasTabla.push({
            name: project[`tectno${i}`],
            implementation: project[`tectno${i}_1`],
        });
    }
}
---
<Layout title={project.titulo}>
  <main class="hero">
    <section class="flex flex-col md:flex-row items-start gap-8 mb-12">
      <div class="w-full md:w-1/3 flex-shrink-0">
        <img src={project.imagenPrincipal} alt={`Imagen principal de ${project.titulo}`} class="rounded-md shadow-lg w-full h-auto object-cover">
      </div>

      <div class="w-full md:w-2/3">
        <h1 class="text-4xl font-bold text-[var(--text-primary-project)] mb-3">{project.titulo}</h1>        
        <br>
        <div class="flex flex-wrap items-center gap-x-4 gap-y-2 --text-primary mb-4 text-sm font-mono">
          <span class="flex items-center gap-1.5">
            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"></path></svg>
            {project.fecha}
          </span>
          <span class="text-gray-600">|</span>
          <span>{project.desarrollo}</span>
          <span class="text-gray-600">|</span>
          <span>{project.tecnologias1}</span>
        </div>

        <br>

        <div>
          <span class="text-[var(--text-primary-project)]">{project.advertencia}</span>
        {project.linkDemo && (
          <a href={project.linkDemo} target="_blank" rel="noopener noreferrer" class="text-[var(--text-primary-project)] hover:underline transition-colors duration-300">
            Ver Proyecto
          </a>
        )}
        </div>
        
      </div>
    </section>

    <br>

    <section class="bg-slate-800/40 border border-slate-700/50 rounded-lg subti">
      <p class="text-lg leading-relaxed">{project.subtitulo}</p>
    </section>

    <br>

    <section class="prose prose-lg prose-invert max-w-none prose-p:leading-relaxed prose-p:text-gray-300">
        <p>{project.descripcionCorta}</p>
        <p>{project.descripcionLarga}</p>
    
        <h2 class="text-[var(--text-primary-project)] !text-2xl !font-bold !mb-4 !mt-12">Funcionalidades</h2>
        <p>{project.funcionalidades}</p>
        <br>
        <ul class="!p-0 !list-none">
            {funcionalidades.map(func => (
                <li class="mb-4">
                    <strong>{func.title}</strong> 
                    <span class="text-[var(--text-secondary-project)]">{func.description}</span>
                </li>
            ))}
        </ul>
    </section>

    <br>

    <section class="mt-12">
        <div class="grid grid-cols-2 gap-4">
            {project.imagen1 && <img src={project.imagen1} alt="Imagen 1 del proyecto" class="rounded-lg shadow-lg col-span-2 w-full h-auto object-cover" />}
            {project.imagen2 && <img src={project.imagen2} alt="Imagen 2 del proyecto" class="rounded-lg shadow-lg w-full h-auto object-cover" />}
            {project.imagen3 && <img src={project.imagen3} alt="Imagen 3 del proyecto" class="rounded-lg shadow-lg w-full h-auto object-cover" />}
        </div>
    </section>

    <section class="mt-12">
      <h2 class="text-cyan-400 text-2xl font-bold mb-4">Tecnolog√≠as</h2>
      <div class="bg-slate-800/40 rounded-lg overflow-hidden border border-slate-700/50">
        <div class="divide-y divide-slate-700/50">
          {tecnologiasTabla.map(tech => (
            <div class="grid grid-cols-1 md:grid-cols-3 gap-2 p-4">
              <div class="font-semibold text-white md:col-span-1">{tech.name}</div>
              <div class="text-gray-400 md:col-span-2">{tech.implementation}</div>
            </div>
          ))}
        </div>
      </div>
    </section>
    
    <div class="text-center mt-16">
        <a href="/" class="text-cyan-400 hover:underline">&larr; Volver a todos los proyectos</a>
    </div>
  </main>
</Layout>

<style>
.hero {
  display: grid;
  justify-content: center;
  align-items: center;
  min-height: 60vh; 
  overflow-x: hidden;
  padding-left: 500px;
  padding-right: 500px;
  padding-top: 100px;
  }

.subti{
  padding: 15px;
}
</style>